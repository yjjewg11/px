var KDPhotoItem=function(q,r,t){var k={callback:null,ajax_uploadByphone:function(a){e.ajax_uploadByphone(a)},query:function(a,b,c){var f;c=Store.getGroup();a=a?a:c[0].uuid;var d=Store.getChooseClass(a);f||(f="");b||(b=d&&0!=d.length?d[0].uuid:null);React.render(React.createElement(l,{groupuuid:a,label:f,group_List:G_selected_dataModelArray_byArray(c,"uuid","brand_name"),classList:G_selected_dataModelArray_byArray(d,"uuid","name"),classuuid:b}),G_get_div_body())}},m=React.createClass({displayName:"Common_mg_Class_big_fn",handleClick:function(a,b){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417?")){var c=a.uuid;$.AMUI.progress.start();$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/delete.json?uuid\x3d"+c,dataType:"json",async:!0,success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?b.ajax_list():alert(a.ResMsg.message)},rror:G_ajax_error_fn})}},render:function(){var a=this,b=this.props.Penthat;if(this.props.imgsList)return React.createElement("div",null,React.createElement("ul",{className:"am-gallery am-avg-sm-3 am-avg-md-4 am-avg-lg-6 am-gallery-imgbordered"},this.props.imgsList.map(function(c){var f=c.path,d=f?f.split("@"):"";return React.createElement("li",{id:"Common_mg_Class_big_fn_item_"+c.uuid,className:"G_class_phtoto_Img"},React.createElement("div",{className:"am-gallery-item"},React.createElement("a",{href:d[0],title:""},React.createElement("img",{src:f,alt:"","data-rel":d[0]}))),React.createElement("div",{className:"G_class_phtoto_Img_close"},React.createElement(AMR_Button,{onClick:a.handleClick.bind(this,c,b)},"X")))})))}}),h=[],l=React.createClass({displayName:"Query_photo_rect",getInitialState:function(){return this.getStateByPropes(this.props)},getStateByPropes:function(a){var b=[];$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryLabel.json",data:{group_uuid:this.props.groupuuid,class_uuid:this.props.classuuid},dataType:"json",async:!1,success:function(a){"success"==a.ResMsg.status?(b=a.list,b.push({value:"",label:"\u6240\u6709"}),h=b.slice(0,-1)):(alert(a.ResMsg.message),G_resMsg_filter(a.ResMsg))},error:G_ajax_error_fn});return{classList:this.props.classList,queryForm:{groupuuid:this.props.groupuuid,label:this.props.label,classuuid:this.props.classuuid},label_list:b,pageNo:1,show_list:[],list:[]}},componentWillReceiveProps:function(a){this.setState(this.getStateByPropes(a))},handleChange_selectgroup:function(a){var b,c;b=Store.getChooseClass(a);(c=$("input[name\x3d'class_uuid']").val())||(c=b&&0!=b.length?b[0].uuid:null);this.state.queryForm.groupuuid=a;this.state.queryForm.classuuid=c;this.state.classList=G_selected_dataModelArray_byArray(b,"uuid","name");this.ajax_list();this.setState(this.state)},handleChange:function(a){a=$("#queryForm").serializeJson();this.state.queryForm=a;this.setState(this.state);this.ajax_list()},handleClick:function(a){React.render(React.createElement(n,{formdata:a}),G_get_div_body())},pageClick:function(a,b){var c=this.state;"pre"==a?2>c.pageNo?G_msg_pop("\u7b2c\u4e00\u9875\u4e86"):(--c.pageNo,this.ajax_list(c)):"next"==a&&(!b||b.length<c.pageSize?G_msg_pop("\u6700\u540e\u4e00\u9875\u4e86"):(c.pageNo+=1,this.ajax_list(c)))},handleClick_query:function(a){this.state.pageNo=1;this.ajax_list()},ajax_callback:function(a){this.state.list=null==a?[]:a.data;this.state.pageSize=a.pageSize;"1"==this.state.pageNo&&(this.state.totalCount=a.totalCount);this.setState(this.state)},ajax_list:function(){var a=this.state.queryForm;"\u6240\u6709"==a.label&&(a.label="");a.pageNo=this.state.pageNo;$.AMUI.progress.start();var b=this;$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryMy.json",data:a,dataType:"json",success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?b.ajax_callback(a.list):(alert(a.ResMsg.message),G_resMsg_filter(a.ResMsg))},error:G_ajax_error_fn})},componentDidMount:function(){this.ajax_list();$(".am-gallery").pureview()},handle_onKeyDown:function(a){if(G_isKeyDown_enter(a))return this.handleClick_query(),!1},render:function(){var a=this.state.queryForm,b=this.state,c=this.state.list;c.pageNo=this.state.pageNo;for(var f=[],d,e=[],g=0;g<b.label_list.length;g++)b.label_list[g].label&&(d={value:null,label:null},d.value=b.label_list[g].label,d.label=b.label_list[g].label,e.push(d));this.state.label_list=e;for(g=0;g<c.length;g++)d={path:null,groupuuid:null,classuuid:null,uuid:null,pageNo:null},d.path=c[g].path,d.groupuuid=b.queryForm.groupuuid,d.classuuid=b.queryForm.classuuid,d.uuid=c[g].uuid,d.pageNo=b.pageNo,f.push(d);return React.createElement("div",null,React.createElement("div",{className:"header"},React.createElement("hr",null)),React.createElement(AMR_Panel,null,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"pre",f)},"\u4e0a\u4e00\u9875"),React.createElement(AMR_Button,{amStyle:"default",disabled:"false"},"\u7b2c",b.pageNo,"\u9875"),React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"next",f)},"\u4e0b\u4e00\u9875"),React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.handleClick.bind(this,b)},"\u4e0a\u4f20\u7167\u7247"))),React.createElement(AMUIReact.Form,{id:"queryForm",inline:!0,onKeyDown:this.handle_onKeyDown},React.createElement(AMR_ButtonToolbar,null,React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"groupuuid",name:"groupuuid",onChange:this.handleChange_selectgroup,btnWidth:"200",data:this.props.group_List,btnStyle:"primary",value:a.groupuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"classuuid",name:"classuuid",placeholder:"\u73ed\u7ea7\u5207\u6362",onChange:this.handleChange,btnWidth:"200",data:b.classList,btnStyle:"primary",value:a.classuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label",name:"label",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange,btnWidth:"200",data:e,btnStyle:"primary",value:a.label})))),React.createElement("div",{className:"am-comment-bd"},React.createElement(m,{imgsList:f,Penthat:this,state:this.state})),React.createElement("legend",null),React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"pre",f)},"\u4e0a\u4e00\u9875"),React.createElement(AMR_Button,{amStyle:"default",disabled:"false"},"\u7b2c",b.pageNo,"\u9875"),React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"next",f)},"\u4e0b\u4e00\u9875")))}}),e={cropper:null,callbackFN:null,type:4,base64:null,groupuuid:null,do_lrz:function(){var a,b=e.upload_files_arr.pop();a=Math.round(G_img_Photo/G_img_number*100);G_that.state.photoNum=G_img_Photo;G_that.state.num=a;G_that.setState(G_that.state);b&&lrz(b,{before:function(){console.log("\u538b\u7f29\u5f00\u59cb")},fail:function(a){console.error(a)},always:function(){console.log("\u538b\u7f29\u7ed3\u675f")},done:function(a){console.log(a);a&&a.base64&&e.ajax_uploadByphone(a.base64)}})},upload_files_arr:[],bind_onchange:function(a,b){e.upload_files_arr=[];e.groupuuid=null;e.callbackFN=b;window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack?$(a).bind("click",function(){G_CallPhoneFN.selectImgForCallBack("KDPhotoItem.ajax_uploadByphone","0","500")}):$(a).bind("change",function(){console.log("\u521d\u59cb\u4e0a\u4f20");G_img_number=G_img_Photo=0;var a=Math.round(G_img_Photo/G_img_number*100);G_that.state.photoNum=G_img_Photo;G_that.state.num=a;G_that.setState(G_that.state);G_img_number=this.files.length;for(a=0;a<this.files.length;a++)e.upload_files_arr.push(this.files[a]);e.do_lrz()})},ajax_uploadByphone:function(a){$.AMUI.progress.start();formObject=$("#KdPhotoForm").serializeJson();formObject.base64=a;$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/uploadBase64.json",timeout:0,dataType:"json",data:formObject,async:!0,success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?(G_img_Photo+=1,e.callbackFN&&(e.callbackFN(a.imgUrl,a.data.uuid),e.do_lrz())):alert(a.ResMsg.message)},error:G_ajax_error_fn})}};G_img_number=null;G_img_Photo=0;G_that=null;var n=React.createClass({displayName:"Img_photo_rect",getInitialState:function(){for(var a,b=0;b<h.length;b++)h[b].label&&(a={value:null,label:null},a.value=h[b].label,a.label=h[b].label,this.props.formdata.show_list.push(a));this.props.formdata.div_list=[];this.props.formdata.show_list.push({value:"\u6dfb\u52a0\u65b0\u6807\u7b7e",label:"\u6dfb\u52a0\u65b0\u6807\u7b7e"});return this.props.formdata},buttion_black_Click:function(a){k.query(a.queryForm.groupuuid,a.queryForm.classuuid,a.pageNo)},imgDivNum:0,getNewImgDiv:function(){this.imgDivNum++;return"Classnews_edit_"+this.imgDivNum},addShowImg:function(a,b){var c=this.getNewImgDiv();$("#show_imgList").append("\x3cdiv id\x3d'"+c+"'\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e");this.state.div_list.push({parentDivId:c});this.setState(this.state);React.render(React.createElement(p,{url:a,parentDivId:c,uuid:b}),document.getElementById(c))},upload_files_arr:[],componentDidMount:function(){this.editor=$("#classnews_content").xheditor(xhEditor_classnews_emot);var a=this;e.bind_onchange("#file_img_upload",function(b,c){a.addShowImg(b,c)});e.groupuuid=this.props.formdata.groupuuid;if($("#imgs").val())for(var b=$("#imgs").val().split(","),c=0;c<b.length;c++)this.addShowImg(b[c])},handleChange:function(){var a=$("input[name\x3d'label']").val();this.state.queryForm.label=a;this.setState(this.state);this.setState($("#KdPhotoForm").serializeJson())},handleChange_label:function(a){"\u6dfb\u52a0\u65b0\u6807\u7b7e"==a?this.disp_prompt():(this.state.queryForm.label=a,this.setState(this.state),this.setState($("#KdPhotoForm").serializeJson()))},disp_prompt:function(){var a=prompt("\u81ea\u5b9a\u4e49\u6807\u7b7e","");null!=a&&""!=a&&(this.state.queryForm.label=a,this.state.show_list.push({value:a,label:a}),this.setState(this.state),this.setState($("#KdPhotoForm").serializeJson()))},buttion_LestGo:function(){for(var a=0;a<this.state.div_list.length;a++)$("#"+this.state.div_list[a].parentDivId).remove();this.state.div_list=[];this.state.show_list=[];this.state.num=0;this.state.photoNum=0;this.state.queryForm.label="";this.props.formdata.div_list=[];this.props.formdata.show_list.push({value:"\u6dfb\u52a0\u65b0\u6807\u7b7e",label:"\u6dfb\u52a0\u65b0\u6807\u7b7e"});this.setState(this.props.formdata)},render:function(){var a=this.state;G_that=this;console.log("this.state.state;",this.state);var b=React.createElement(AMR_Input,{type:"file",label:"\u4e0a\u4f20\u56fe\u7247\uff1a",id:"file_img_upload",accept:"image/*",capture:"camera",multiple:!0});window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack&&(b=React.createElement(AMR_Button,{amStyle:"primary",id:"file_img_upload"},"\u4e0a\u4f20\u56fe\u7247"));a.num||(a.num=0);a.photoNum||(a.photoNum=0);return React.createElement("div",{id:"KdPhotoForm_list_div"},React.createElement("div",{className:"header"},React.createElement("hr",null)),React.createElement("div",{className:"am-g  am-u-md-6 am-u-sm-12"},React.createElement("form",{id:"KdPhotoForm",method:"post",className:"am-form"},React.createElement("input",{type:"hidden",name:"group_uuid",value:a.queryForm.groupuuid}),React.createElement("input",{type:"hidden",name:"class_uuid",value:a.queryForm.classuuid}),React.createElement(AMR_ButtonToolbar,null,React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label_Selected",name:"label_Selected",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange_label,btnWidth:"200",data:a.show_list,btnStyle:"primary",value:a.queryForm.label}))),React.createElement("label",{className:"am-u-lg-2 am-u-md-2 am-u-sm-4 am-form-label"},"\u6807\u7b7e:"),React.createElement("div",{className:"am-u-lg-10 am-u-md-10 am-u-sm-8"},React.createElement(PxInput,{type:"text",name:"label",id:"label",value:a.queryForm.label,onChange:this.handleChange,maxLength:"45",placeholder:"\u4e0d\u8d85\u8fc745\u4f4d"}))),React.createElement("label",null,"\u56fe\u7247\u4e0a\u4f20\u8fdb\u5ea6:\u5df2\u5b8c\u6210"+a.photoNum+"\u5f20"),React.createElement("div",null,React.createElement(AMUIReact.Progress,{now:a.num,label:"\u5df2\u4f20"+a.photoNum+"\u5f20"})),React.createElement("div",{id:"show_imgList"}),React.createElement("br",null),React.createElement("div",{className:"cls"}),b,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.buttion_black_Click.bind(this,a)},"\u786e\u5b9a"),React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.buttion_LestGo.bind(this)},"\u7ee7\u7eed\u4e0a\u4f20"))))}}),p=React.createClass({displayName:"KDphoto_Img_canDel",deleteImg:function(a,b){$.AMUI.progress.start();$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/delete.json?uuid\x3d"+b,dataType:"json",async:!0,success:function(b){$.AMUI.progress.done();"success"==b.ResMsg.status?$("#"+a).remove():alert(b.ResMsg.message)},rror:G_ajax_error_fn})},render:function(){var a=this.props.uuid;return React.createElement("div",{className:"G_cookplan_Img"},React.createElement("img",{className:"G_cookplan_Img_img",src:this.props.url,alt:"\u56fe\u7247\u4e0d\u5b58\u5728"}),React.createElement("div",{className:"G_cookplan_Img_close",onClick:this.deleteImg.bind(this,this.props.parentDivId,a)},React.createElement("img",{src:hostUrlCDN+"i/close.png",border:"0"})))}});return k}();