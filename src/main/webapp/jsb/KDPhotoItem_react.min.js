var KDPhotoItem=function(p,q,r){var k={callback:null,ajax_uploadByphone:function(a){d.ajax_uploadByphone(a)},query:function(a,b,c){var f;c=Store.getGroup();a=a?a:c[0].uuid;var e=Store.getChooseClass(a);f||(f="");b||(b=e&&0!=e.length?e[0].uuid:null);React.render(React.createElement(l,{groupuuid:a,label:f,group_List:G_selected_dataModelArray_byArray(c,"uuid","brand_name"),classList:G_selected_dataModelArray_byArray(e,"uuid","name"),classuuid:b}),G_get_div_body())}},m=React.createClass({displayName:"Common_mg_Class_big_fn",handleClick:function(a){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417?")){var b=a.uuid;$.AMUI.progress.start();$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/delete.json?uuid\x3d"+b,dataType:"json",async:!0,success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?$("#Common_mg_Class_big_fn_item_"+b).hide():alert(a.ResMsg.message)},rror:G_ajax_error_fn})}},render:function(){var a=this;if(this.props.imgsList)return React.createElement("div",null,React.createElement("ul",{className:"am-gallery am-avg-sm-3 am-avg-md-4 am-avg-lg-6 am-gallery-imgbordered"},this.props.imgsList.map(function(b){var c=b.path,f=c?c.split("@"):"";return React.createElement("li",{id:"Common_mg_Class_big_fn_item_"+b.uuid,className:"G_class_phtoto_Img"},React.createElement("div",{className:"am-gallery-item"},React.createElement("a",{href:f[0],title:""},React.createElement("img",{src:c,alt:"","data-rel":f[0]}))),React.createElement("div",{className:"G_class_phtoto_Img_close"},React.createElement(AMR_Button,{onClick:a.handleClick.bind(this,b)},"X")))})))}}),h=[],l=React.createClass({displayName:"Query_photo_rect",getInitialState:function(){return this.getStateByPropes(this.props)},getStateByPropes:function(a){var b=[];$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryLabel.json",data:{group_uuid:this.props.groupuuid,class_uuid:this.props.classuuid},dataType:"json",async:!1,success:function(a){"success"==a.ResMsg.status?(b=a.list,b.push({value:"",label:"\u6240\u6709"}),h=b.slice(0,-1)):(alert(a.ResMsg.message),G_resMsg_filter(a.ResMsg))},error:G_ajax_error_fn});return{classList:this.props.classList,queryForm:{groupuuid:this.props.groupuuid,label:this.props.label,classuuid:this.props.classuuid},label_list:b,pageNo:1,show_list:[],list:[]}},componentWillReceiveProps:function(a){this.setState(this.getStateByPropes(a))},handleChange_selectgroup:function(a){var b,c;b=Store.getChooseClass(a);(c=$("input[name\x3d'class_uuid']").val())||(c=b&&0!=b.length?b[0].uuid:null);this.state.queryForm.groupuuid=a;this.state.queryForm.classuuid=c;this.state.classList=G_selected_dataModelArray_byArray(b,"uuid","name");this.ajax_list();this.setState(this.state)},handleChange:function(a){a=$("#queryForm").serializeJson();this.state.queryForm=a;this.setState(this.state);this.ajax_list()},handleClick:function(a){React.render(React.createElement(n,{formdata:a}),G_get_div_body())},pageClick:function(a,b){var c=this.state;"pre"==a?2>c.pageNo?G_msg_pop("\u7b2c\u4e00\u9875\u4e86"):(--c.pageNo,this.ajax_list(c)):"next"==a&&(!b||b.length<c.pageSize?G_msg_pop("\u6700\u540e\u4e00\u9875\u4e86"):(c.pageNo+=1,this.ajax_list(c)))},handleClick_query:function(a){this.state.pageNo=1;this.ajax_list()},ajax_callback:function(a){this.state.list=null==a?[]:a.data;this.state.pageSize=a.pageSize;"1"==this.state.pageNo&&(this.state.totalCount=a.totalCount);this.setState(this.state)},ajax_list:function(){var a=this.state.queryForm;"\u6240\u6709"==a.label&&(a.label="");a.pageNo=this.state.pageNo;$.AMUI.progress.start();var b=this;$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryMy.json",data:a,dataType:"json",success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?b.ajax_callback(a.list):(alert(a.ResMsg.message),G_resMsg_filter(a.ResMsg))},error:G_ajax_error_fn})},componentDidMount:function(){this.ajax_list();$(".am-gallery").pureview()},handle_onKeyDown:function(a){if(G_isKeyDown_enter(a))return this.handleClick_query(),!1},render:function(){var a=this.state.queryForm,b=this.state,c=this.state.list;c.pageNo=this.state.pageNo;for(var f=[],e,d=[],g=0;g<b.label_list.length;g++)b.label_list[g].label&&(e={value:null,label:null},e.value=b.label_list[g].label,e.label=b.label_list[g].label,d.push(e));this.state.label_list=d;for(g=0;g<c.length;g++)e={path:null,groupuuid:null,classuuid:null,uuid:null,pageNo:null},e.path=c[g].path,e.groupuuid=b.queryForm.groupuuid,e.classuuid=b.queryForm.classuuid,e.uuid=c[g].uuid,e.pageNo=b.pageNo,f.push(e);return React.createElement("div",null,React.createElement("div",{className:"header"},React.createElement("hr",null)),React.createElement(AMR_Panel,null,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"pre",f)},"\u4e0a\u4e00\u9875"),React.createElement(AMR_Button,{amStyle:"default",disabled:"false"},"\u7b2c",b.pageNo,"\u9875"),React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"next",f)},"\u4e0b\u4e00\u9875"),React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.handleClick.bind(this,b)},"\u4e0a\u4f20\u7167\u7247"))),React.createElement(AMUIReact.Form,{id:"queryForm",inline:!0,onKeyDown:this.handle_onKeyDown},React.createElement(AMR_ButtonToolbar,null,React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"groupuuid",name:"groupuuid",onChange:this.handleChange_selectgroup,btnWidth:"200",data:this.props.group_List,btnStyle:"primary",value:a.groupuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"classuuid",name:"classuuid",placeholder:"\u73ed\u7ea7\u5207\u6362",onChange:this.handleChange,btnWidth:"200",data:b.classList,btnStyle:"primary",value:a.classuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label",name:"label",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange,btnWidth:"200",data:d,btnStyle:"primary",value:a.label})))),React.createElement("div",{className:"am-comment-bd"},React.createElement(m,{imgsList:f,state:this.state})),React.createElement("legend",null),React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"pre",f)},"\u4e0a\u4e00\u9875"),React.createElement(AMR_Button,{amStyle:"default",disabled:"false"},"\u7b2c",b.pageNo,"\u9875"),React.createElement(AMR_Button,{amStyle:"default",onClick:this.pageClick.bind(this,"next",f)},"\u4e0b\u4e00\u9875")))}}),d={cropper:null,callbackFN:null,type:4,base64:null,groupuuid:null,do_lrz:function(){var a=d.upload_files_arr.pop();G_that.state.num=Math.round(G_img_Photo/G_img_number*100);G_that.setState(G_that.state);a&&lrz(a,{before:function(){console.log("\u538b\u7f29\u5f00\u59cb")},fail:function(a){console.error(a)},always:function(){console.log("\u538b\u7f29\u7ed3\u675f")},done:function(a){console.log(a);a&&a.base64&&d.ajax_uploadByphone(a.base64)}})},upload_files_arr:[],bind_onchange:function(a,b){d.upload_files_arr=[];d.groupuuid=null;d.callbackFN=b;window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack?$(a).bind("click",function(){G_CallPhoneFN.selectImgForCallBack("KDPhotoItem.ajax_uploadByphone","0","500")}):$(a).bind("change",function(){console.log("\u521d\u59cb\u4e0a\u4f20");G_img_number=G_img_Photo=0;G_that.state.num=Math.round(G_img_Photo/G_img_number*100);G_that.setState(G_that.state);G_img_number=this.files.length;for(var a=0;a<this.files.length;a++)d.upload_files_arr.push(this.files[a]);d.do_lrz()})},ajax_uploadByphone:function(a){$.AMUI.progress.start();formObject=$("#KdPhotoForm").serializeJson();formObject.base64=a;$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/uploadBase64.json",timeout:0,dataType:"json",data:formObject,async:!0,success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?(G_img_Photo+=1,d.callbackFN&&(d.callbackFN(a.imgUrl,a.data.uuid),d.do_lrz())):alert(a.ResMsg.message)},error:G_ajax_error_fn})}};G_img_number=null;G_img_Photo=0;G_that=null;var n=React.createClass({displayName:"Img_photo_rect",getInitialState:function(){for(var a,b=0;b<h.length;b++)h[b].label&&(a={value:null,label:null},a.value=h[b].label,a.label=h[b].label,this.props.formdata.show_list.push(a));return this.props.formdata},buttion_black_Click:function(a){k.query(a.queryForm.groupuuid,a.queryForm.classuuid,a.pageNo)},imgDivNum:0,getNewImgDiv:function(){this.imgDivNum++;return"Classnews_edit_"+this.imgDivNum},addShowImg:function(a){var b=this.getNewImgDiv();$("#show_imgList").append("\x3cdiv id\x3d'"+b+"'\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e");React.render(React.createElement(ClassNews_Img_canDel,{url:a,parentDivId:b}),document.getElementById(b))},upload_files_arr:[],componentDidMount:function(){this.editor=$("#classnews_content").xheditor(xhEditor_classnews_emot);var a=this;d.bind_onchange("#file_img_upload",function(b,c){a.addShowImg(b)});d.groupuuid=this.props.formdata.groupuuid;if($("#imgs").val())for(var b=$("#imgs").val().split(","),c=0;c<b.length;c++)this.addShowImg(b[c])},handleChange:function(){var a=$("input[name\x3d'label']").val();this.state.queryForm.label=a;this.setState(this.state);this.setState($("#KdPhotoForm").serializeJson())},handleChange_label:function(a){this.state.queryForm.label=a;this.setState(this.state);this.setState($("#KdPhotoForm").serializeJson())},render:function(){var a=this.state;G_that=this;var b=React.createElement(AMR_Input,{type:"file",label:"\u4e0a\u4f20\u56fe\u7247",id:"file_img_upload",help:"\u9009\u62e9\u56fe\u7247",accept:"image/*",capture:"camera",multiple:!0});window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack&&(b=React.createElement(AMR_Button,{amStyle:"primary",id:"file_img_upload"},"\u4e0a\u4f20\u56fe\u7247"));return React.createElement("div",null,React.createElement("div",{className:"header"},React.createElement("hr",null)),React.createElement("div",{className:"am-g"},React.createElement("form",{id:"KdPhotoForm",method:"post",className:"am-form"},React.createElement("input",{type:"hidden",name:"group_uuid",value:a.queryForm.groupuuid}),React.createElement("input",{type:"hidden",name:"class_uuid",value:a.queryForm.classuuid}),React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.buttion_black_Click.bind(this,a)},"\u8fd4\u56de"),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label_Selected",name:"label_Selected",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange_label,btnWidth:"200",data:a.show_list,btnStyle:"primary",value:a.queryForm.label}))),React.createElement("label",{className:"am-u-lg-2 am-u-md-2 am-u-sm-4 am-form-label"},"\u6807\u7b7e:"),React.createElement("div",{className:"am-u-lg-10 am-u-md-10 am-u-sm-8"},React.createElement(PxInput,{type:"text",name:"label",id:"label",value:a.queryForm.label,onChange:this.handleChange,maxLength:"45",placeholder:"\u4e0d\u8d85\u8fc745\u4f4d"}))),React.createElement("label",null,"\u56fe\u7247\u4e0a\u4f20\u8fdb\u5ea6:"),React.createElement("div",null,React.createElement(AMUIReact.Progress,{now:a.num,label:a.num+"%"})),React.createElement("div",{id:"show_imgList"}),React.createElement("br",null),React.createElement("div",{className:"cls"}),b))}});return k}();