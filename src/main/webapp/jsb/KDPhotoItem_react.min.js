var KDPhotoItem=function(){var k={callback:null,ajax_uploadByphone:function(a,b){try{b&&(G_img_number=parseInt(b))}catch(c){}f.ajax_uploadByphone(a)},query:function(a,b,c){c||(c="");React.render(React.createElement(l,{groupuuid:a,label:c,classuuid:b}),G_get_div_body())}},g=[],l=React.createClass({displayName:"Query_photo_div",load_more_btn_id:"load_more_",pageNo:1,classnewsreply_list_div:"am-list-news-bd",getInitialState:function(){return this.getPropsState(this.props)},getPropsState:function(){var a=this.props.groupuuid,b=this.props.classuuid,c=$.AMUI.store.get("G_photo_query_My_All_list");c||(c=1);var d=null,e=null;a||(a=$.AMUI.store.get("G_photo_groupuuid"));d=1==c?Store.getGroupNoGroup_wjd():Store.getGroup();a||(a=d[0].uuid);e=1==c?Store.getMyByClassList(a):Store.getChooseClass(a);groupArry=G_selected_dataModelArray_byArray(d,"uuid","brand_name");e=G_selected_dataModelArray_byArray(e,"uuid","name");b||(b=$.AMUI.store.get("G_photo_classuuid"));b||(b=e&&0!=e.length?e[0].uuid:null);d=this.props.label;d={groupuuid:a,label:d?d+"":"",classuuid:b};a=this.query_Label(a,b);return{query_My_All_list:c,groupList:groupArry,classList:e,queryForm:d,label_list:a,pageNo:1,show_list:[],list:[]}},query_Label:function(a,b){var c=[];a||(a=this.props.groupuuid);b||(b=this.props.classuuid);$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryLabel.json",data:{group_uuid:a,class_uuid:b},dataType:"json",async:!1,success:function(a){"success"==a.ResMsg.status?(c=a.list,c.push({value:"",label:"\u6240\u6709"}),g=c.slice(0,-1)):(alert(a.ResMsg.message),G_resMsg_filter(a.ResMsg))},error:G_ajax_error_fn});return c},componentWillReceiveProps:function(a){a=this.getPropsState(a);this.setState(a)},componentDidMount:function(){this.load_more_data()},handle_onKeyDown:function(a){if(G_isKeyDown_enter(a))return this.handleClick_query(),!1},handleClick_query:function(a){this.state.pageNo=1;this.refresh_data()},load_more_data:function(){$("#"+this.classnewsreply_list_div).append("\x3cdiv id\x3d"+this.classnewsreply_list_div+this.pageNo+"\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e");var a=this;m(this.classnewsreply_list_div+this.pageNo,this.state.queryForm,this.pageNo,this,function(b){if(b){var c=a.state.totalCount%a.state.pageSize,d=Math.round(a.state.totalCount/a.state.pageSize);b.data.length<b.pageSize?$("#"+a.load_more_btn_id).hide():a.state.pageNo==d&&0==c?$("#"+a.load_more_btn_id).hide():$("#"+a.load_more_btn_id).show();a.pageNo++}});this.setState(this.state)},refresh_data:function(){var a=this.query_Label(this.state.queryForm.groupuuid,this.state.queryForm.classuuid);this.state.label_list=a;this.pageNo=1;$("#"+this.classnewsreply_list_div).html("");this.load_more_data()},handleClick:function(a){React.render(React.createElement(n,{formdata:a}),G_get_div_body())},All_group_class:function(){var a,b,c,d;b=Store.getGroupNoGroup_wjd();a||(a=b[0].uuid);c=G_selected_dataModelArray_byArray(b,"uuid","brand_name");b=(d=Store.getChooseClass(a))&&0!=d.length?d[0].uuid:null;d=G_selected_dataModelArray_byArray(d,"uuid","name");$.AMUI.store.set("G_photo_query_My_All_list",2);this.state.pageNo=1;this.state.groupList=c;this.state.classList=d;this.state.queryForm.label="";this.state.queryForm.groupuuid=a;this.state.queryForm.classuuid=b;this.state.query_My_All_list=2;this.refresh_data()},My_group_class:function(){var a,b,c,d;b=Store.getGroup();a||(a=b[0].uuid);c=G_selected_dataModelArray_byArray(b,"uuid","brand_name");b=(d=Store.getMyByClassList(a))&&0!=d.length?d[0].uuid:null;d=G_selected_dataModelArray_byArray(d,"uuid","name");$.AMUI.store.set("G_photo_query_My_All_list",1);this.state.pageNo=1;this.state.groupList=c;this.state.classList=d;this.state.queryForm.label="";this.state.queryForm.groupuuid=a;this.state.queryForm.classuuid=b;this.state.query_My_All_list=1;this.refresh_data()},handleChange_selectgroup:function(a){var b,c;b=1==this.state.query_My_All_list?Store.getMyByClassList(a):Store.getChooseClass(a);c||(c=b&&0!=b.length?b[0].uuid:null);G_photo_groupuuid=a;$.AMUI.store.set("G_photo_groupuuid",a);this.state.pageNo=1;this.state.queryForm.label="";this.state.queryForm.groupuuid=a;this.state.queryForm.classuuid=c;this.state.classList=G_selected_dataModelArray_byArray(b,"uuid","name");this.refresh_data()},handleChange:function(a){G_photo_classuuid=$("input[name\x3d'classuuid']").val();$.AMUI.store.set("G_photo_classuuid",G_photo_classuuid);this.state.pageNo=1;this.state.queryForm.label="";this.state.queryForm.classuuid=a;this.refresh_data()},handleChange_label:function(a){G_photo_classuuid=$("input[name\x3d'classuuid']").val();$.AMUI.store.set("G_photo_classuuid",G_photo_classuuid);a=$("#queryForm").serializeJson();this.state.pageNo=1;this.state.queryForm=a;this.refresh_data()},phtot_Click:function(a){KDPhoto_play_move.queryForPayMove(a)},render:function(){this.load_more_btn_id="load_more_"+this.props.uuid;var a,b,c,d=this.state.queryForm,e=this.state,h=[];1==e.query_My_All_list?(c="G_Edit_show",b="G_Edit_hide"):(c="G_Edit_hide",b="G_Edit_show");for(var f=0;f<e.label_list.length;f++)e.label_list[f].label&&(a={value:null,label:null},a.value=e.label_list[f].label,a.label=e.label_list[f].label,h.push(a));this.state.label_list=h;return React.createElement("div",{"data-am-widget":"list_news",className:"am-list-news am-list-news-default"},React.createElement(AMR_Panel,null,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.phtot_Click.bind(this,e)},"\u7cbe\u54c1\u76f8\u518c"))),React.createElement(AMR_Panel,null,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amSize:"xs",amStyle:"secondary",onClick:this.handleClick.bind(this,e)},"\u4e0a\u4f20\u7167\u7247"),React.createElement(AMR_Button,{className:c,amStyle:"secondary",onClick:this.All_group_class.bind(this)},"\u67e5\u8be2\u6240\u6709\u73ed\u7ea7"),React.createElement(AMR_Button,{className:b,amStyle:"secondary",onClick:this.My_group_class.bind(this)},"\u67e5\u8be2\u6211\u7684\u73ed\u7ea7"))),React.createElement("label",null,"\u56fe\u7247\u603b\u6570\uff1a"+this.state.totalCount+"\u5f20"),React.createElement(AMUIReact.Form,{id:"queryForm",inline:!0,onKeyDown:this.handle_onKeyDown},React.createElement(AMR_ButtonToolbar,null,React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"groupuuid",name:"groupuuid",onChange:this.handleChange_selectgroup,btnWidth:"200",data:e.groupList,btnStyle:"primary",value:d.groupuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"classuuid",name:"classuuid",placeholder:"\u73ed\u7ea7\u5207\u6362",onChange:this.handleChange,btnWidth:"200",data:e.classList,btnStyle:"primary",value:d.classuuid})),React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label",name:"label",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange_label,btnWidth:"200",data:h,btnStyle:"primary",value:d.label})))),React.createElement("div",{id:this.classnewsreply_list_div,className:"am-list-news-bd"}),React.createElement("div",{className:"am-list-news-ft"},React.createElement("a",{className:"am-list-news-more am-btn am-btn-default ",id:this.load_more_btn_id,onClick:this.load_more_data.bind(this)},"\u67e5\u770b\u66f4\u591a \u00bb")))}}),m=function(a,b,c,d,e){b.pageNo=c;"\u6240\u6709"==b.label&&(b.label="");$.AMUI.progress.start();$.ajax({type:"GET",url:hostUrl+"rest/kDPhotoItem/queryMy.json",data:b,dataType:"json",async:!1,success:function(b){$.AMUI.progress.done();"success"==b.ResMsg.status?(d.state.list=b.list.data,d.state.pageSize=b.list.pageSize,"1"==c&&(d.state.totalCount=b.list.totalCount),React.render(React.createElement(p,{events:b.list,Propsthat:d,responsive:!0,bordered:!0,striped:!0,hover:!0,striped:!0}),document.getElementById(a)),"function"==typeof e&&e(b.list)):(alert(b.ResMsg.message),G_resMsg_filter(b.ResMsg))},error:G_ajax_error_fn})},p=React.createClass({displayName:"Query_photo_rect",getInitialState:function(){return this.props.events},componentWillReceiveProps:function(a){this.setState(this.getStateByPropes(a))},componentDidMount:function(){$(".am-gallery").pureview()},render:function(){return React.createElement("div",{className:"am-comment-bd"},React.createElement(q,{imgsList:this.state.data,Penthat:this.props.Propsthat}))}}),q=React.createClass({displayName:"Common_mg_Class_big_fn",handleClick:function(a,b){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417?")){var c=a.uuid;$.AMUI.progress.start();$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/delete.json?uuid\x3d"+c,dataType:"json",async:!0,success:function(a){$.AMUI.progress.done();"success"==a.ResMsg.status?b.refresh_data():alert(a.ResMsg.message)},rror:G_ajax_error_fn})}},render:function(){var a=this,b=this.props.Penthat;if(this.props.imgsList)return React.createElement("div",null,React.createElement("ul",{className:"am-gallery am-avg-sm-4 am-avg-md-6 am-avg-lg-12 am-gallery-imgbordered"},this.props.imgsList.map(function(c){var d=c.path,e=c.label,f="";e||(f="G_Edit_hide");var g=d?d.split("@"):"";0!=d.btn_Letgo&&(buttion_LestGo_className="G_Edit_show");return React.createElement("li",{id:"Common_mg_Class_big_fn_item_"+c.uuid,className:"G_class_phtoto_Img G_ch_classNews_item"},React.createElement("div",{className:"am-gallery-item"},React.createElement("a",{href:g[0],title:""},React.createElement("img",{src:d,alt:"","data-rel":g[0]})),React.createElement("span",{className:"G_class_phtoto_label "+f},e),React.createElement("div",{className:"am-comment-actions"},c.create_user,"|",GTimeShow.showByTime(c.create_time))),React.createElement("div",{className:"G_class_phtoto_Img_close",onClick:a.handleClick.bind(this,c,b)}))})))}}),f={cropper:null,callbackFN:null,type:4,base64:null,groupuuid:null,do_lrz:function(){console.log("fpPhotoUploadTask.upload_files_arr",f.upload_files_arr);var a=f.upload_files_arr.pop();a&&lrz(a,{before:function(){console.log("\u538b\u7f29\u5f00\u59cb")},fail:function(a){console.error(a)},always:function(){console.log("\u538b\u7f29\u7ed3\u675f")},done:function(a){console.log(a);a&&a.base64&&f.ajax_uploadByphone(a.base64)}})},upload_files_arr:[],bind_onchange:function(a,b){f.upload_files_arr=[];f.groupuuid=null;f.callbackFN=b;window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack?$(a).bind("click",function(){G_CallPhoneFN.selectImgForCallBack("KDPhotoItem.ajax_uploadByphone","0","500")}):$(a).bind("change",function(){console.log("\u521d\u59cb\u4e0a\u4f20");progress_width=G_img_number=G_img_Photo=0;G_img_number=this.files.length;G_data=$("#KdPhotoForm").serializeJson();for(var a=0;a<this.files.length;a++)f.upload_files_arr.push(this.files[a]);f.do_lrz()})},ajax_uploadByphone:function(a){$.AMUI.progress.start();var b=function(a,b){3>G_reUploadNumber?(G_reUploadNumber++,f.ajax_uploadByphone(b)):(G_img_Photo--,G_reUploadNumber=0,alert(a),f.do_lrz())};formObject=$("#KdPhotoForm").serializeJson();formObject.base64=a;$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/uploadBase64.json",timeout:0,dataType:"json",data:formObject,async:!0,success:function(c){$.AMUI.progress.done();if("success"==c.ResMsg.status){G_img_Photo||(G_img_Photo=0);G_img_Photo++;G_reUploadNumber=0;var d=Math.round(G_img_Photo/G_img_number*100);G_that.state.photoNum=G_img_Photo;G_that.state.photoAllNum=G_img_number;G_that.state.num=d;G_that.state.btn_Letgo=!0;G_that.setState(G_that.state);f.callbackFN&&f.callbackFN(c.imgUrl,c.data.uuid);f.do_lrz()}else b(c.ResMsg.message,a)},error:function(c,d,e){$.AMUI.progress.done();var f=null,f=c.responseText&&c.responseText.indexOf("G_key_no_connect_server")?"\u6ca1\u8fde\u63a5\u4e0a\u4e92\u8054\u7f51.":c.status+","+d+"\x3d"+e;b(f,a);console.log(",ajax_error\uff1a",c.status+","+d+"\x3d"+e)}})}};G_img_number=null;G_img_Photo=0;G_that=null;G_data=[];G_reUploadNumber=0;var n=React.createClass({displayName:"Img_photo_rect",getInitialState:function(){for(var a,b=0;b<g.length;b++)g[b].label&&(a={value:null,label:null},a.value=g[b].label,a.label=g[b].label,this.props.formdata.show_list.push(a));this.props.formdata.btn_Letgo=!1;this.props.formdata.div_list=[];this.props.formdata.show_list.push({value:"\u6dfb\u52a0\u65b0\u6807\u7b7e",label:"\u6dfb\u52a0\u65b0\u6807\u7b7e"});return this.props.formdata},buttion_black_Click:function(a){k.query(a.queryForm.groupuuid,a.queryForm.classuuid,a.queryForm.label)},imgDivNum:0,getNewImgDiv:function(){this.imgDivNum++;return"Classnews_edit_"+this.imgDivNum},addShowImg:function(a,b){var c=this.getNewImgDiv();0!=$("#show_imgList").length&&($("#show_imgList").append("\x3cdiv id\x3d'"+c+"'\x3e\u52a0\u8f7d\u4e2d...\x3c/div\x3e"),this.state.div_list.push({parentDivId:c}),this.setState(this.state),React.render(React.createElement(r,{url:a,parentDivId:c,uuid:b}),document.getElementById(c)))},upload_files_arr:[],componentDidMount:function(){this.editor=$("#classnews_content").xheditor(xhEditor_classnews_emot);var a=this;f.bind_onchange("#file_img_upload",function(b,c){a.addShowImg(b,c)});f.groupuuid=this.props.formdata.groupuuid;if($("#imgs").val())for(var b=$("#imgs").val().split(","),c=0;c<b.length;c++)this.addShowImg(b[c])},handleChange_label:function(a){"\u6dfb\u52a0\u65b0\u6807\u7b7e"==a?this.disp_prompt():(this.state.queryForm.label=a,this.setState(this.state),this.setState($("#KdPhotoForm").serializeJson()))},disp_prompt:function(){var a=prompt("\u81ea\u5b9a\u4e49\u6807\u7b7e(\u6700\u591a45\u4f4d)","");null!=a&&""!=a&&(this.state.queryForm.label=a,this.state.show_list.push({value:a,label:a}),this.setState(this.state),this.setState($("#KdPhotoForm").serializeJson()))},buttion_LestGo:function(){for(var a=0;a<this.state.div_list.length;a++)$("#"+this.state.div_list[a].parentDivId).remove();this.state.div_list=[];this.state.show_list=[];this.state.num=0;this.state.photoNum=0;this.state.photoAllNum=0;this.state.queryForm.label="";this.props.formdata.div_list=[];this.props.formdata.btn_Letgo=!1;this.setState(this.props.formdata)},render:function(){var a=this.state,b,c=Store.getGroupNameByUuid(a.queryForm.groupuuid),d=Store.getClassNameByUuid(a.queryForm.classuuid);G_that=this;var e=React.createElement(AMR_Input,{type:"file",label:"\u4e0a\u4f20\u56fe\u7247\uff1a",id:"file_img_upload",accept:"image/*",capture:"camera",multiple:!0});window.JavaScriptCall&&window.JavaScriptCall.selectImgForCallBack&&(e=React.createElement(AMR_Button,{amStyle:"primary",id:"file_img_upload"},"\u4e0a\u4f20\u56fe\u7247"));a.num||(a.num=0);a.photoNum||(a.photoNum=0);a.photoAllNum||(a.photoAllNum=0);b=0==a.btn_Letgo?"G_Edit_hide":"G_Edit_show";return React.createElement("div",{id:"KdPhotoForm_list_div"},React.createElement("div",{className:"header"},React.createElement("hr",null)),React.createElement("div",{className:"am-g"},React.createElement("form",{id:"KdPhotoForm",method:"post",className:"am-form"},React.createElement("input",{type:"hidden",name:"group_uuid",value:a.queryForm.groupuuid}),React.createElement("input",{type:"hidden",name:"class_uuid",value:a.queryForm.classuuid}),React.createElement(AMR_ButtonToolbar,null,React.createElement("div",{className:"am-fl am-margin-left-sm am-margin-bottom-xs"},React.createElement(AMUIReact.Selected,{id:"label",name:"label",placeholder:"\u6807\u7b7e\u5207\u6362",onChange:this.handleChange_label,btnWidth:"200",data:a.show_list,btnStyle:"primary",value:a.queryForm.label}))),React.createElement("label",null,"\u6807\u7b7e\uff1a"+a.queryForm.label),React.createElement("br",null)),React.createElement("label",null,"\u5b66\u6821\uff1a"+c),React.createElement("br",null),React.createElement("label",null,"\u73ed\u7ea7\uff1a"+d),React.createElement("br",null),React.createElement("label",null,"\u56fe\u7247\u4e0a\u4f20\u8fdb\u5ea6:\u5df2\u5b8c\u6210"+a.photoNum+"/"+a.photoAllNum+"\u5f20"),React.createElement("div",null,React.createElement(AMUIReact.Progress,{now:a.num,label:"\u5df2\u4f20"+a.photoNum+"\u5f20"})),React.createElement("div",{id:"show_imgList"}),React.createElement("br",null),React.createElement("div",{className:"cls"}),e,React.createElement(AMR_ButtonToolbar,null,React.createElement(AMR_Button,{amSize:"xs",disabled:a.photoNum<a.photoAllNum,amStyle:"secondary",onClick:this.buttion_black_Click.bind(this,a)},"\u786e\u8ba4\u8fd4\u56de"),React.createElement(AMR_Button,{amSize:"xs",disabled:a.photoNum<a.photoAllNum,className:b,amStyle:"secondary",onClick:this.buttion_LestGo.bind(this)},"\u7ee7\u7eed\u4e0a\u4f20"))))}}),r=React.createClass({displayName:"KDphoto_Img_canDel",deleteImg:function(a,b){$.AMUI.progress.start();$.ajax({type:"POST",url:hostUrl+"rest/kDPhotoItem/delete.json?uuid\x3d"+b,dataType:"json",async:!0,success:function(b){$.AMUI.progress.done();"success"==b.ResMsg.status?$("#"+a).remove():alert(b.ResMsg.message)},rror:G_ajax_error_fn})},render:function(){var a=this.props.uuid;return React.createElement("div",{className:"G_cookplan_Img"},React.createElement("img",{className:"G_cookplan_Img_img",src:this.props.url,alt:"\u56fe\u7247\u4e0d\u5b58\u5728"}),React.createElement("div",{className:"G_cookplan_Img_close",onClick:this.deleteImg.bind(this,this.props.parentDivId,a)},React.createElement("img",{src:hostUrlCDN+"i/close.png",border:"0"})))}});return k}();